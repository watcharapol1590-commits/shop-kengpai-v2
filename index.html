<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡πÄ‡∏Å‡πà‡∏á‡∏õ‡πâ‡∏≤‡∏¢ V2 - ‡∏™‡∏±‡πà‡∏á‡∏ó‡∏≥‡∏õ‡πâ‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Sarabun:wght@300;400;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Sarabun', sans-serif; }
        .preview-box { position: relative; width: 100%; max-width: 400px; margin: auto; aspect-ratio: 16/6; overflow: hidden; }
        #previewImg { width: 100%; height: 100%; object-fit: contain; }
        #logoPreview { position: absolute; top: 18%; left: 8%; width: 18%; height: auto; pointer-events: none; z-index: 10; }
    </style>
</head>
<body class="bg-slate-100 pb-12">

    <div class="max-w-md mx-auto bg-white min-h-screen shadow-2xl overflow-hidden">
        <div class="bg-gradient-to-r from-blue-700 to-indigo-800 p-6 text-white text-center rounded-b-[40px] shadow-lg">
            <h1 class="text-2xl font-bold">KENGPAI SHOP V2</h1>
            <p class="text-blue-100 text-xs mt-1">‡∏≠‡∏≠‡∏Å‡πÅ‡∏ö‡∏ö‡∏õ‡πâ‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡∏î‡πâ‡∏ß‡∏¢‡∏ï‡∏±‡∏ß‡πÄ‡∏≠‡∏á</p>
        </div>

        <div class="p-4 sticky top-0 z-20 bg-white/90 backdrop-blur-sm border-b">
            <div class="preview-box bg-slate-200 border-2 border-indigo-100 rounded-2xl p-2 shadow-inner">
                <img id="previewImg" src="https://via.placeholder.com/400x150?text=‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ß‡∏±‡∏™‡∏î‡∏∏‡∏õ‡πâ‡∏≤‡∏¢" class="rounded-xl">
                <img id="logoPreview" src="" class="hidden"> 
                <div class="absolute bottom-2 right-4 bg-indigo-600 text-white px-4 py-1 rounded-full text-sm font-bold shadow-lg">
                    <span id="currentPrice">0</span> ‡∏ö‡∏≤‡∏ó
                </div>
            </div>
        </div>

        <div class="p-5 space-y-4">
            <div>
                <label class="text-xs font-bold text-gray-500 mb-1 block">1. ‡∏ß‡∏±‡∏™‡∏î‡∏∏‡∏õ‡πâ‡∏≤‡∏¢ (Material)</label>
                <select id="sel-material" onchange="updateUI()" class="w-full border-2 p-3 rounded-xl focus:border-indigo-500 outline-none transition-all"></select>
            </div>

            <div class="grid grid-cols-2 gap-3">
                <div>
                    <label class="text-xs font-bold text-gray-500 mb-1 block">2. ‡πÇ‡∏•‡πÇ‡∏Å‡πâ (Logo)</label>
                    <select id="sel-logo" onchange="updateUI()" class="w-full border-2 p-3 rounded-xl focus:border-indigo-500 outline-none"></select>
                </div>
                <div>
                    <label class="text-xs font-bold text-gray-500 mb-1 block">3. ‡∏ü‡∏≠‡∏ô‡∏ï‡πå (Font)</label>
                    <select id="sel-font" onchange="updateUI()" class="w-full border-2 p-3 rounded-xl focus:border-indigo-500 outline-none"></select>
                </div>
            </div>

            <div class="grid grid-cols-2 gap-3">
                <div>
                    <label class="text-xs font-bold text-gray-500 mb-1 block">4. ‡∏Ç‡∏ô‡∏≤‡∏î (Size)</label>
                    <select id="sel-size" onchange="updateUI()" class="w-full border-2 p-3 rounded-xl focus:border-indigo-500 outline-none"></select>
                </div>
                <div>
                    <label class="text-xs font-bold text-gray-500 mb-1 block">5. ‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î</label>
                    <select id="sel-lines" onchange="updateUI()" class="w-full border-2 p-3 rounded-xl focus:border-indigo-500 outline-none"></select>
                </div>
            </div>

            <div class="grid grid-cols-2 gap-3">
                <div>
                    <label class="text-xs font-bold text-gray-500 mb-1 block">6. ‡∏Ç‡∏≤‡∏ï‡∏¥‡∏î‡∏ï‡∏±‡πâ‡∏á (Attach)</label>
                    <select id="sel-attachment" onchange="updateUI()" class="w-full border-2 p-3 rounded-xl focus:border-indigo-500 outline-none"></select>
                </div>
                <div>
                    <label class="text-xs font-bold text-gray-500 mb-1 block">7. ‡∏Å‡∏≤‡∏£‡πÄ‡∏Ñ‡∏•‡∏∑‡∏≠‡∏ö (Finish)</label>
                    <select id="sel-finish" onchange="updateUI()" class="w-full border-2 p-3 rounded-xl focus:border-indigo-500 outline-none"></select>
                </div>
            </div>

            <div id="textInputContainer" class="bg-indigo-50 p-4 rounded-2xl border-2 border-indigo-100 space-y-3">
                <p class="text-xs font-bold text-indigo-600 text-center uppercase tracking-wider">‡∏£‡∏∞‡∏ö‡∏∏‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ö‡∏ô‡∏õ‡πâ‡∏≤‡∏¢</p>
                <input type="text" id="txt-line1" placeholder="‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•" class="w-full p-3 border rounded-xl focus:ring-2 ring-indigo-300 outline-none">
                <input type="text" id="txt-line2" placeholder="‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á / ‡∏ä‡∏∑‡πà‡∏≠‡∏†‡∏≤‡∏©‡∏≤‡∏≠‡∏±‡∏á‡∏Å‡∏§‡∏©" class="w-full p-3 border rounded-xl hidden">
                <input type="text" id="txt-line3" placeholder="‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏á‡∏≤‡∏ô / ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏≠‡∏∑‡πà‡∏ô‡πÜ" class="w-full p-3 border rounded-xl hidden">
            </div>

            <button onclick="addToCart()" class="w-full bg-indigo-600 text-white py-4 rounded-2xl font-bold shadow-xl active:scale-95 transition-transform">+ ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏•‡∏á‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤</button>
        </div>

        <div id="cartArea" class="p-5 border-t-8 border-slate-100">
            <h2 class="text-xl font-bold mb-4 flex justify-between items-center">
                üõí ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ó‡∏µ‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å <span id="cartCount" class="bg-red-500 text-white text-xs px-2 py-1 rounded-full">0</span>
            </h2>
            <div id="cartList" class="space-y-3"></div>
            
            <div id="checkoutBox" class="mt-8 hidden space-y-4">
                <div class="p-4 bg-slate-900 text-white rounded-2xl flex justify-between items-center">
                    <span class="text-lg">‡∏¢‡∏≠‡∏î‡∏™‡∏∏‡∏ó‡∏ò‡∏¥:</span>
                    <span id="grandTotal" class="text-2xl font-bold text-yellow-400">0 ‡∏ö‡∏≤‡∏ó</span>
                </div>
                <div class="bg-white border-2 p-4 rounded-2xl space-y-2">
                    <input type="text" id="custName" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡∏£‡∏±‡∏ö" class="w-full p-3 border rounded-lg">
                    <input type="tel" id="custPhone" placeholder="‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå" class="w-full p-3 border rounded-lg">
                    <textarea id="custAddr" placeholder="‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà‡∏à‡∏±‡∏î‡∏™‡πà‡∏á‡πÇ‡∏î‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î" class="w-full p-3 border rounded-lg" rows="3"></textarea>
                    <button onclick="submitOrder()" id="btnSubmit" class="w-full bg-green-600 text-white py-4 rounded-2xl font-bold text-lg shadow-lg">‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // *** ‡πÉ‡∏™‡πà URL ‡∏Ç‡∏≠‡∏á Apps Script ‡∏Ñ‡∏∏‡∏ì‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà ***
        const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbwF07YaoGYtv_-Fl7Hm6RmcKWuhkTu7K7qWc2YcY_s-6mvidJJjtL5tRfXsGxKewMpj/exec";

        const db = [
            // Materials
            { id: 1, name: "‡∏õ‡πâ‡∏≤‡∏¢‡∏≠‡∏Ñ‡∏¥‡∏•‡∏¥‡∏Ñ", price: 100, cat: "material", img: "https://drive.google.com/thumbnail?id=1klCw3wrT398UeutTY8B4bZSTJPxv4S3r" },
            { id: 2, name: "‡∏õ‡πâ‡∏≤‡∏¢‡πÑ‡∏°‡πâ‡∏°‡∏∞‡∏Ç‡∏≤‡∏°", price: 120, cat: "material", img: "https://drive.google.com/thumbnail?id=13UxNtFF-DppQB0Ls7xp7IsRvcKUwsweB" },
            { id: 3, name: "‡∏õ‡πâ‡∏≤‡∏¢‡∏û‡∏•‡∏≤‡∏™‡∏ï‡∏¥‡∏Å", price: 100, cat: "material", img: "https://drive.google.com/thumbnail?id=1RgwekNK5w-ECkxMVg0E9SmaQCEPGhphj" },
            { id: 4, name: "‡∏õ‡πâ‡∏≤‡∏¢‡∏≠‡∏±‡∏Å‡∏©‡∏£‡∏ô‡∏π‡∏ô‡∏ä‡∏∏‡∏õ‡πÄ‡∏á‡∏¥‡∏ô‡∏°‡∏µ‡∏Ç‡∏≠‡∏ö", price: 150, cat: "material", img: "https://drive.google.com/thumbnail?id=1mLGLdA4BZaB5kuG3rGgHQJSJy60s9HJI" },
            { id: 5, name: "‡∏õ‡πâ‡∏≤‡∏¢‡∏≠‡∏±‡∏Å‡∏©‡∏£‡∏ô‡∏π‡∏ô‡∏ä‡∏∏‡∏õ‡πÄ‡∏á‡∏¥‡∏ô‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡∏≠‡∏ö", price: 150, cat: "material", img: "https://drive.google.com/thumbnail?id=1cSiErvvO-RDqSiKDtMtFQB2zXFmpf9S1" },
            { id: 6, name: "‡∏õ‡πâ‡∏≤‡∏¢‡∏≠‡∏±‡∏Å‡∏©‡∏£‡∏ô‡∏π‡∏ô‡∏ä‡∏∏‡∏õ‡∏ó‡∏≠‡∏á‡∏°‡∏µ‡∏Ç‡∏≠‡∏ö", price: 180, cat: "material", img: "https://drive.google.com/thumbnail?id=1Pu-_p0c4ZAMNlVj1wPrbeI4TO98yImhZ" },
            { id: 7, name: "‡∏õ‡πâ‡∏≤‡∏¢‡∏≠‡∏±‡∏Å‡∏©‡∏£‡∏ô‡∏π‡∏ô‡∏ä‡∏∏‡∏õ‡∏ó‡∏≠‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡∏≠‡∏ö", price: 180, cat: "material", img: "https://drive.google.com/thumbnail?id=1t2XBGzAEBhK6kTqMr5yaqHdFDh5ZrHdj" },
            { id: 8, name: "‡∏õ‡πâ‡∏≤‡∏¢‡∏û‡∏∑‡πâ‡∏ô‡πÄ‡∏á‡∏≤‡∏ä‡∏∏‡∏õ‡πÄ‡∏á‡∏¥‡∏ô", price: 180, cat: "material", img: "https://drive.google.com/thumbnail?id=1sfMoGiwG2ZVyc1WbvaGHfjkCAG3BBqBi" },
            { id: 9, name: "‡∏õ‡πâ‡∏≤‡∏¢‡∏û‡∏∑‡πâ‡∏ô‡πÄ‡∏á‡∏≤‡∏ä‡∏∏‡∏õ‡∏ó‡∏≠‡∏á", price: 200, cat: "material", img: "https://drive.google.com/thumbnail?id=1Z7OxlZAD9HHp4dQ7rOVC80HqeaekXzl6" },
            { id: 10, name: "‡∏õ‡πâ‡∏≤‡∏¢‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏£‡∏≤‡∏¢‡∏ä‡∏∏‡∏õ‡πÄ‡∏á‡∏¥‡∏ô", price: 180, cat: "material", img: "https://drive.google.com/thumbnail?id=1ue5jxh_gdR_PLXhT-1JOahRRYkIpotod" },
            { id: 11, name: "‡∏õ‡πâ‡∏≤‡∏¢‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏£‡∏≤‡∏¢‡∏ä‡∏∏‡∏õ‡∏ó‡∏≠‡∏á", price: 200, cat: "material", img: "https://drive.google.com/thumbnail?id=11p-TC8S77w64fa00IE-sLWx3Ws08O-4g" },
            { id: 12, name: "‡∏õ‡πâ‡∏≤‡∏¢‡∏Ç‡∏≠‡∏ö‡πÄ‡∏á‡∏≤‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏£‡∏≤‡∏¢‡∏ä‡∏∏‡∏õ‡πÄ‡∏á‡∏¥‡∏ô", price: 180, cat: "material", img: "https://drive.google.com/thumbnail?id=1v2e6gmJFC4qbaTEWSo6U1GO_ym2F4QNj" },
            { id: 13, name: "‡∏õ‡πâ‡∏≤‡∏¢‡∏Ç‡∏≠‡∏ö‡πÄ‡∏á‡∏≤‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏£‡∏≤‡∏¢‡∏ä‡∏∏‡∏õ‡∏ó‡∏≠‡∏á", price: 200, cat: "material", img: "https://drive.google.com/thumbnail?id=1UYaeVGg8J6P5p5xsG8k-Gsz41VKpH22J" },
            // Logos
            { id: 14, name: "‡πÑ‡∏°‡πà‡∏ï‡∏¥‡∏î‡πÇ‡∏•‡πÇ‡∏Å‡πâ", price: 0, cat: "logo", img: "" },
            { id: 15, name: "‡∏õ‡πâ‡∏≤‡∏¢‡∏ó‡∏´‡∏≤‡∏£", price: 0, cat: "logo", img: "https://drive.google.com/thumbnail?id=1Q870c5Vc2A1WNoImBQaMgcg5o7Qmt_96" },
            { id: 16, name: "‡∏ß‡∏õ‡∏£", price: 30, cat: "logo", img: "https://drive.google.com/thumbnail?id=1iqKnYDCAAQ3dkKPL7RyNkeDfNogmayIv" },
            { id: 17, name: "‡∏ï‡∏≥‡∏£‡∏ß‡∏à", price: 0, cat: "logo", img: "https://drive.google.com/thumbnail?id=1mLGLdA4BZaB5kuG3rGgHQJSJy60s9HJI" },
            { id: 18, name: "‡πÄ‡∏™‡∏°‡∏≤", price: 0, cat: "logo", img: "https://drive.google.com/thumbnail?id=1EddGi7R6MCmq-_VSwGPLgOwtCXh3PdNA" },
            { id: 19, name: "‡∏Ñ‡∏£‡∏π‡πÄ‡∏≠‡∏Å‡∏ä‡∏ô", price: 0, cat: "logo", img: "https://drive.google.com/thumbnail?id=1G57dabHH9HaBt73Cn4XANppKmY-HADni" },
            { id: 20, name: "‡∏™‡∏¥‡∏á‡∏´‡πå‡∏ß‡∏á‡∏Å‡∏•‡∏°", price: 0, cat: "logo", img: "https://drive.google.com/thumbnail?id=19_1Jx5gWiOqKY1mS8Rcd9vXxbY1lsHlV" },
            { id: 21, name: "‡∏™‡∏≤‡∏ò‡∏≤‡∏£‡∏ì‡∏™‡∏∏‡∏Ç", price: 0, cat: "logo", img: "https://drive.google.com/thumbnail?id=1qiEV8gRij9RqD1z97yrPFIxupD1euy_9" },
            { id: 22, name: "‡πÄ‡∏Å‡∏©‡∏ï‡∏£", price: 0, cat: "logo", img: "https://drive.google.com/thumbnail?id=1sYdIbf4F1wfhiFgTiEJCprie2YCu_i1L" },
            { id: 23, name: "‡∏Å‡∏≤‡∏£‡πÑ‡∏ü‡∏ü‡πâ‡∏≤‡∏™‡πà‡∏ß‡∏ô‡∏†‡∏π‡∏°‡∏¥‡∏†‡∏≤‡∏Ñ", price: 0, cat: "logo", img: "https://drive.google.com/thumbnail?id=191RoYWjjIrNtUcdyH7PpaHvSFwVRS9Vw" },
            { id: 24, name: "‡∏Å‡∏ó‡∏°", price: 0, cat: "logo", img: "https://drive.google.com/thumbnail?id=1Tu4WVAY--acmYVpUsbPBKN0mbV775QiI" },
            { id: 25, name: "‡πÇ‡∏•‡πÇ‡∏Å‡πâ‡∏≠‡∏∑‡πà‡∏ô‡πÜ(‡πÅ‡∏à‡πâ‡∏á‡∏£‡∏π‡∏õ)", price: 0, cat: "logo", img: "" },
            // Fonts
            { id: 26, name: "‡∏™‡∏≤‡∏£‡∏ö‡∏£‡∏£‡∏ì", price: 0, cat: "font", img: "https://drive.google.com/thumbnail?id=17WVoz3H4KJpoJhcVGLBLaz_tqhuhunvc" },
            { id: 27, name: "‡∏≠‡∏≤‡∏•‡∏±‡∏Å‡∏©‡∏ì‡πå", price: 0, cat: "font", img: "https://drive.google.com/thumbnail?id=1EuC8TStvoeN6NgDMmujlqwOy3ytgcUcF" },
            { id: 28, name: "‡∏ß‡∏£‡∏£‡∏ì‡∏£‡∏µ", price: 0, cat: "font", img: "https://drive.google.com/thumbnail?id=1Z7hUNDYxvRckkxD8vTPCnnTYncTTJzNP" },
            { id: 29, name: "‡πÄ‡∏≠‡∏Å‡∏ä‡∏±‡∏¢", price: 0, cat: "font", img: "https://drive.google.com/thumbnail?id=1iqk4t2dAnrn1ipeJde4f8W-db-5_78Uc" },
            { id: 30, name: "‡∏ß‡∏±‡∏ô‡∏™‡∏¥‡∏Å‡∏≤", price: 0, cat: "font", img: "https://drive.google.com/thumbnail?id=1ObmsAY1cnc1Wx22qe_qJ5VYEPLNDYxvd" },
            { id: 31, name: "‡∏®‡∏±‡∏Å‡∏®‡∏¥‡∏©‡∏¢‡πå", price: 0, cat: "font", img: "https://drive.google.com/thumbnail?id=1mXbO_H9XLOiDFsfBJgCPlbYLHw1NC8O_" },
            { id: 32, name: "‡∏≠‡∏∑‡πà‡∏ô‡πÜ(‡πÅ‡∏à‡πâ‡∏á)", price: 0, cat: "font", img: "" },
            // Sizes
            { id: 33, name: "1.5 X 7.0 (‡∏ï‡∏≥‡∏£‡∏ß‡∏à)", price: 0, cat: "size", img: "https://drive.google.com/thumbnail?id=1kL-zKRn_AcDtwXCXF7kCeacsdBEIyyL7" },
            { id: 34, name: "1.5 X 7.5 (‡∏õ‡πâ‡∏≤‡∏¢‡πÄ‡∏•‡πá‡∏Å)", price: 0, cat: "size", img: "https://drive.google.com/thumbnail?id=1kL-zKRn_AcDtwXCXF7kCeacsdBEIyyL7" },
            { id: 35, name: "2.0 X 7.5 (‡∏ó‡∏´‡∏≤‡∏£)", price: 0, cat: "size", img: "https://drive.google.com/thumbnail?id=1kL-zKRn_AcDtwXCXF7kCeacsdBEIyyL7" },
            { id: 36, name: "2.5 X 7.5 (‡∏õ‡πâ‡∏≤‡∏¢‡πÉ‡∏´‡∏ç‡πà)", price: 20, cat: "size", img: "https://drive.google.com/thumbnail?id=1kL-zKRn_AcDtwXCXF7kCeacsdBEIyyL7" },
            // Lines
            { id: 37, name: "1 ‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î", price: 0, cat: "lines", count: 1 },
            { id: 38, name: "2 ‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î", price: 0, cat: "lines", count: 2 },
            { id: 39, name: "3 ‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î", price: 0, cat: "lines", count: 3 },
            // Attachment
            { id: 40, name: "‡∏Ç‡∏≤‡πÄ‡∏Ç‡πá‡∏°‡∏Å‡∏•‡∏±‡∏î", price: 0, cat: "attachment", img: "https://drive.google.com/thumbnail?id=1sjBKC_qs07JndLRE20OMKZl5j-wWgWBV" },
            { id: 41, name: "‡∏Ç‡∏≤‡∏´‡∏°‡∏∏‡∏î(‡∏Å‡∏¥‡πä‡∏ü‡∏•‡πä‡∏≠‡∏Ñ)", price: 0, cat: "attachment", img: "https://drive.google.com/thumbnail?id=1sjBKC_qs07JndLRE20OMKZl5j-wWgWBV" },
            { id: 42, name: "‡πÅ‡∏°‡πà‡πÄ‡∏´‡∏•‡πá‡∏Å", price: 50, cat: "attachment", img: "https://drive.google.com/thumbnail?id=1sjBKC_qs07JndLRE20OMKZl5j-wWgWBV" },
            // Finish
            { id: 43, name: "‡πÑ‡∏°‡πà‡πÄ‡∏Ñ‡∏•‡∏∑‡∏≠‡∏ö‡πÄ‡∏£‡∏ã‡∏¥‡πà‡∏ô", price: 0, cat: "finish", img: "https://drive.google.com/thumbnail?id=1mLGLdA4BZaB5kuG3rGgHQJSJy60s9HJI" },
            { id: 44, name: "‡πÄ‡∏Ñ‡∏•‡∏∑‡∏≠‡∏ö‡πÄ‡∏£‡∏ã‡∏¥‡πà‡∏ô", price: 0, cat: "finish", img: "https://drive.google.com/thumbnail?id=1mLGLdA4BZaB5kuG3rGgHQJSJy60s9HJI" }
        ];

        let cart = [];

        function init() {
            const categories = ['material', 'logo', 'font', 'size', 'lines', 'attachment', 'finish'];
            categories.forEach(cat => {
                const sel = document.getElementById('sel-' + cat);
                db.filter(i => i.cat === cat).forEach(i => sel.add(new Option(`${i.name} (+${i.price})`, i.id)));
            });
            updateUI();
        }

        function updateUI() {
            const getVal = (id) => db.find(i => i.id == document.getElementById('sel-'+id).value);
            const mat = getVal('material');
            const logo = getVal('logo');
            const lines = getVal('lines');

            // Preview logic
            document.getElementById('previewImg').src = mat.img || 'https://via.placeholder.com/400x150?text=KENGPAI';
            const lp = document.getElementById('logoPreview');
            if(logo.img) { lp.src = logo.img; lp.classList.remove('hidden'); } else { lp.classList.add('hidden'); }

            // Price logic
            const total = ['material', 'logo', 'font', 'size', 'lines', 'attachment', 'finish']
                        .reduce((sum, id) => sum + getVal(id).price, 0);
            document.getElementById('currentPrice').innerText = total;

            // Line visibility logic
            document.getElementById('txt-line2').classList.toggle('hidden', lines.count < 2);
            document.getElementById('txt-line3').classList.toggle('hidden', lines.count < 3);
        }

        function addToCart() {
            const getVal = (id) => db.find(i => i.id == document.getElementById('sel-'+id).value);
            const line1 = document.getElementById('txt-line1').value;
            const line2 = document.getElementById('txt-line2').value;
            const line3 = document.getElementById('txt-line3').value;
            const lineCount = getVal('lines').count;

            if(!line1) return alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•");

            let textInfo = line1;
            if(lineCount >= 2) textInfo += ` | ${line2 || '-(‡πÑ‡∏°‡πà‡∏°‡∏µ)-'}`;
            if(lineCount >= 3) textInfo += ` | ${line3 || '-(‡πÑ‡∏°‡πà‡∏°‡∏µ)-'}`;

            const price = ['material', 'logo', 'font', 'size', 'lines', 'attachment', 'finish']
                        .reduce((sum, id) => sum + getVal(id).price, 0);

            cart.push({
                desc: `${getVal('material').name} + ${getVal('logo').name} (${getVal('size').name})`,
                details: `‡∏ü‡∏≠‡∏ô‡∏ï‡πå: ${getVal('font').name}, ‡∏Ç‡∏≤: ${getVal('attachment').name}, ${getVal('finish').name}`,
                text: textInfo,
                price: price
            });

            renderCart();
            document.getElementById('txt-line1').value = "";
            document.getElementById('txt-line2').value = "";
            document.getElementById('txt-line3').value = "";
        }

        function renderCart() {
            const list = document.getElementById('cartList');
            list.innerHTML = "";
            let subtotal = 0;
            cart.forEach((item, idx) => {
                subtotal += item.price;
                list.innerHTML += `
                    <div class="bg-indigo-50 border border-indigo-100 p-4 rounded-2xl flex justify-between items-start">
                        <div class="text-xs">
                            <p class="font-bold text-indigo-700 text-sm">${item.desc}</p>
                            <p class="text-gray-500">${item.details}</p>
                            <p class="text-gray-800 mt-1 font-bold">‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°: ${item.text}</p>
                            <p class="text-indigo-600 font-bold mt-1">${item.price} ‡∏ö‡∏≤‡∏ó</p>
                        </div>
                        <button onclick="cart.splice(${idx},1);renderCart()" class="text-red-500 font-bold text-xs uppercase">‡∏•‡∏ö</button>
                    </div>`;
            });
            document.getElementById('cartCount').innerText = cart.length;
            document.getElementById('grandTotal').innerText = subtotal + " ‡∏ö‡∏≤‡∏ó";
            document.getElementById('checkoutBox').classList.toggle('hidden', cart.length === 0);
        }

        async function submitOrder() {
            const btn = document.getElementById('btnSubmit');
            const name = document.getElementById('custName').value;
            const phone = document.getElementById('custPhone').value;
            const addr = document.getElementById('custAddr').value;

            if(!name || !phone || !addr) return alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏π‡πâ‡∏£‡∏±‡∏ö‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö‡∏ñ‡πâ‡∏ß‡∏ô");

            const itemsStr = cart.map((i, idx) => 
                `‡∏ä‡∏¥‡πâ‡∏ô‡∏ó‡∏µ‡πà ${idx+1}: ${i.desc} / ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°: ${i.text} (${i.price}‡∏ö.)`
            ).join("\n");

            const payload = {
                name: name,
                phone: phone,
                address: addr,
                items: itemsStr,
                total: document.getElementById('grandTotal').innerText
            };

            btn.disabled = true; btn.innerText = "‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...";
            try {
                const res = await fetch(SCRIPT_URL, { method: 'POST', body: JSON.stringify(payload) });
                const result = await res.json();
                if(result.status === "success") {
                    alert("‚úÖ ‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à! ‡πÄ‡∏£‡∏≤‡∏à‡∏∞‡∏£‡∏µ‡∏ö‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£‡πÉ‡∏´‡πâ‡πÇ‡∏î‡∏¢‡πÄ‡∏£‡πá‡∏ß‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î");
                    cart = []; renderCart();
                }
            } catch (e) { alert("‚ùå ‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•"); }
            finally { btn.disabled = false; btn.innerText = "‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠"; }
        }

        init();
    </script>
</body>
</html>
